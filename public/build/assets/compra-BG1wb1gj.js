document.addEventListener("DOMContentLoaded",()=>{const a=document.body.dataset.usuarioAutenticado==="true",l=function(n){fetch(`/sesion/${n}/getMapa`).then(e=>e.json()).then(e=>{const t=document.getElementById("contenedor-mapa");t.innerHTML="";const d=JSON.parse(e);Object.keys(d).length;const s=Object.keys(d.A).length;t.className=`grid gap-[2px] max-w-full text-white text-xl grid-cols-${s+1}`,t.innerHTML+=`<p class="text-white font-bold block col-start-1 col-end-${+s+2} text-center my-4">VISTA PREVIA SALA</p>`,t.innerHTML+=`<div class="flex justify-center col-start-1 col-end-${+s+2} gap-8 w-full mt-4">
                    <div class="flex items-center gap-2">
                        <svg class="w-6 h-6 sm:w-8 sm:h-8"><use href="#v-icon_standard-available"/></svg>
                        <span class="text-white">Disponible</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <svg class="w-6 h-6 sm:w-8 sm:h-8"><use href="#v-icon_standard-unavailable"/></svg>
                        <span class="text-white">Ocupado</span>
                    </div>
                </div>`,t.innerHTML+=`<div id="pantalla" class="col-start-2 col-end-${+s+2} text-center bg-gray-600 mb-1 px-2">Pantalla</div>`,t.innerHTML+="<div></div>";for(let o=1;o<=s;o++)t.innerHTML+=`<div class="text-center text-base sm:text-lg md:text-xl">${o}</div>`;if(Object.keys(d).forEach(o=>{t.innerHTML+=`<div class="text-center text-base sm:text-lg md:text-xl">${o}</div>`;for(let u=1;u<=s;u++)t.innerHTML+=d[o][u]?'<svg class="w-6 h-6 sm:w-8 sm:h-8"><use href="#v-icon_standard-unavailable"/></svg>':'<svg class="w-6 h-6 sm:w-8 sm:h-8"><use href="#v-icon_standard-available"/></svg>'}),t.innerHTML+=`<div class="col-start-2 col-end-${+s+2} text-center bg-text-color mt-4 p-2 hover:bg-text-color/80">
                    <button id='comprarEntrada' data-idsesion='${n}' class="cursor-pointer">Comprar entradas</button>
                </div>`,document.getElementById("comprarEntrada").addEventListener("click",c),window.innerWidth<1024){const o=document.getElementById("vista-previa-mapa");o&&setTimeout(()=>{o.scrollIntoView({behavior:"smooth",block:"start"})},500)}}).catch(e=>{console.error("Error cargando mapa de butacas:",e)})};document.querySelectorAll(".btnMostrarMapa").forEach(n=>{n.addEventListener("click",e=>{e.currentTarget.dataset.idsesion&&l(e.currentTarget.dataset.idsesion)})});function c(){const n=this.dataset.idsesion;if(a){const e=document.createElement("form");e.method="GET",e.action="/compra/asientos";const t=document.createElement("input");t.type="hidden",t.name="idSesion",t.value=n,e.appendChild(t),document.body.appendChild(e),e.submit()}else{const e=document.querySelector(".botonLogin");e&&e.click()}}const i=document.getElementById("contendor-dias");if(i){const n=i.querySelector("button");n&&r(n.dataset.fecha,n),i.querySelectorAll("button").forEach(e=>{e.addEventListener("click",function(){r(this.dataset.fecha,this)})})}function r(n,e){let t=!1;const d=document.getElementById("contenedor-mapa");d.innerHTML="",document.querySelectorAll(".sesion").forEach(s=>{s.dataset.dia===n?(s.style.display="block",t=!0):s.style.display="none"}),document.getElementById("mensaje-no-sesiones-dia").classList.toggle("hidden",t),document.querySelectorAll(".btn-dia").forEach(s=>{s.classList.remove("bg-text-color/50","font-bold"),s.classList.add("bg-text-color","hover:bg-text-color/80")}),e.classList.remove("bg-text-color","hover:bg-text-color/80"),e.classList.add("bg-text-color/50","font-bold")}});document.addEventListener("DOMContentLoaded",function(){const a=[];let l=document.getElementById("butacasSeleccionadas"),c=document.getElementById("mensaje-error-butacas");document.querySelectorAll(".butaca-disponible").forEach(r=>{r.addEventListener("click",function(){const n=this.dataset.fila,e=this.dataset.columna,t=`${n}-${e}`;a.includes(t)?(a.splice(a.indexOf(t),1),this.querySelector("use").setAttribute("href","#v-icon_standard-available")):(a.push(t),this.querySelector("use").setAttribute("href","#v-icon_standard-selected")),l.innerHTML=a.length>0?`<strong>Butacas seleccionadas:&nbsp;</strong><i>${a.join(", ")}</i>`:"",c&&a.length>0&&c.classList.add("hidden")})});const i=document.getElementById("formContinuar");i&&i.addEventListener("submit",function(r){if(a.length===0){r.preventDefault(),c&&c.classList.remove("hidden");return}document.getElementById("inputButacas").value=JSON.stringify(a)})});
